name: Test Outputs Flow Between Jobs

on:
  workflow_dispatch:

env:
  TEST_ENV: envVariable
  #Secrets defined at the repository level
  USERNAME: ${{ secrets.USERNAME }}
  PASSWORD: ${{ secrets.PASSWORD }}
jobs:
  Create_Message:
    env:
      MESSAGE1: HELLO
      MESSAGE2: WORLD
    runs-on: ubuntu-latest
    #Defines the output generated by the Job
    outputs:
      #output variable name and value assigned in the format steps.<step_id>.outputs.<variable_name_defined>
      output1: ${{ steps.step1.outputs.test }}
      output2: ${{ steps.step2.outputs.test }}
    steps:
      - name: Create Output 1
        #Step ID which is used by the defined output variable to map the step variable value
        id: step1
        #storing the value to step variable using the $GITHUB_OUTPUT. Here the variable name used is test
        run: echo "test=hello" >> "$GITHUB_OUTPUT"
      - name: Create Output 2
        id: step2
        run: |
          echo "test=world" >> "$GITHUB_OUTPUT"
          echo "TestEnvironmentVariable: $TEST_ENV"
          echo "MESSAGE1: ${{ env.MESSAGE1 }}, MESSAGE2: ${{ env.MESSAGE2 }}"
  Receive_Message:
    runs-on: ubuntu-latest
    needs: Create_Message
    steps:
      - name: Receive Message
        #Using the output from Create_Message Job and displaying the output values
        #Accessing the output value from earlier job in the following format needs.<Job_Name>.outputs.<output_variable_name>
        run: |
          echo "OUTPUT1: ${{ needs.Create_Message.outputs.output1 }}"
          echo "OUTPUT2: ${{ needs.Create_Message.outputs.output2 }}"
          echo "TESTING JOB Specific Env Variable : ${{ env.MESSAGE1 }}"
  Matrix_message_job:
    runs-on: ubuntu-latest
    needs: Receive_Message
    outputs:
      output_1: ${{ steps.gen_output.outputs.output_1 }}
      output_2: ${{ steps.gen_output.outputs.output_2 }}
      output_3: ${{ steps.gen_output.outputs.output_3 }}
    #Defining the matrix strategy, using the matrix strategy job outputs will be combined for all jobs with matrix
    strategy:
      matrix:
        version: [1,2,3]
    steps:
      - name: Generate Matrix Output
        id: gen_output
        run: |
          version="${{ matrix.version }}"
          echo "output_${version}=Hello ${version}" >> "$GITHUB_OUTPUT"
  Matrix_receive_job:
    runs-on: ubuntu-latest
    needs: Matrix_message_job
    steps:
      #printing the output as JSON
      - name: Receive Matrix Message
        run: |
          echo "${{ toJSON(needs.Matrix_message_job.outputs) }}"
          echo "PRINTING USERNAME: $USERNAME"
          echo "PRINTING PASSWORD: ${{ env.PASSWORD }} - Gets Masked"